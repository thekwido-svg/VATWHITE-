<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; overflow: hidden; }
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .auth-box { width: 85%; background: #111; padding: 20px; border-radius: 15px; border: 1px solid #333; }
        #multiplier { font-size: 4rem; text-align: center; padding: 40px 0; font-weight: 900; }
        .bet-box { background: #111; padding: 15px; margin: 10px; border-radius: 10px; border: 1px solid #222; }
        .btn-bet { width: 100%; padding: 15px; background: #28a745; color: #fff; border: none; border-radius: 8px; font-weight: bold; }
        .btn-out { width: 100%; padding: 15px; background: #ffc107; color: #00; border: none; border-radius: 8px; font-weight: bold; display: none; }
        input { width: 100%; padding: 12px; background: #000; color: gold; border: 1px solid #333; border-radius: 5px; margin-bottom: 10px; }
        .tab-bar { display: flex; background: #0a0a0a; border-bottom: 2px solid #222; }
        .tab { flex: 1; padding: 15px; text-align: center; font-size: 0.8rem; color: #777; cursor: pointer; }
        .tab.active { color: gold; border-bottom: 2px solid gold; }
    </style>
</head>
<body>
    <div id="auth-screen">
        <h2 style="color:gold;">VATWHITE REGISTER</h2>
        <div class="auth-box">
            <input type="number" id="r-phone" placeholder="Namba ya Simu">
            <input type="password" id="r-pass" placeholder="Password">
            <button class="btn-bet" onclick="handleAuth()">JISAJILI / LOGIN</button>
        </div>
    </div>

    <div style="display:flex; justify-content:space-between; padding:15px; font-weight:bold;">
        <span style="color:gold;">VATWHITE</span>
        <span style="color:#28a745;"><span id="bal">0.00</span> KES</span>
    </div>

    <div id="multiplier">1.00x</div>

    <div class="tab-bar">
        <div class="tab active">BETTING</div>
        <div class="tab">LIVE CHAT</div>
        <div class="tab">MENU</div>
    </div>

    <div class="bet-box">
        <input type="number" id="a1" value="10">
        <button id="b1" class="btn-bet" onclick="pBet()">BET</button>
        <button id="o1" class="btn-out" onclick="cOut()">CASH OUT</button>
    </div>

    <script>
        const socket = io();
        let myPhone = localStorage.getItem('vP'), currentM = 1.0, isBetting = false;

        async function loadUser() {
            if(!myPhone) return;
            const r = await fetch('/admin/user-details/' + myPhone);
            const d = await r.json();
            if(d.success) document.getElementById('bal').innerText = d.data.bal;
        }

        async function handleAuth() {
            const p = document.getElementById('r-phone').value, s = document.getElementById('r-pass').value;
            if(!p || !s) return alert("Jaza zote!");
            await fetch('/register', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({phone:p, password:s}) });
            localStorage.setItem('vP', p); myPhone = p;
            document.getElementById('auth-screen').style.display = 'none'; loadUser();
        }

        socket.on('tick', (m) => {
            currentM = parseFloat(m);
            document.getElementById('multiplier').innerText = m + "x";
            if(isBetting) document.getElementById('o1').innerText = "CASH OUT " + (document.getElementById('a1').value * currentM).toFixed(2);
        });

        socket.on('crash', () => {
            document.getElementById('multiplier').style.color = 'red';
            isBetting = false;
            document.getElementById('b1').style.display = 'block'; document.getElementById('o1').style.display = 'none';
        });

        socket.on('new_game', () => {
            document.getElementById('multiplier').style.color = 'white'; loadUser();
        });

        async function pBet() {
            const amt = parseFloat(document.getElementById('a1').value);
            if(amt > parseFloat(document.getElementById('bal').innerText)) return alert("Huna pesa!");
            await fetch('/admin/update-balance', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({phone: myPhone, amount: -amt}) });
            isBetting = true; loadUser();
            document.getElementById('b1').style.display = 'none'; document.getElementById('o1').style.display = 'block';
        }

        async function cOut() {
            if(!isBetting) return;
            isBetting = false;
            const win = parseFloat(document.getElementById('a1').value * currentM);
            await fetch('/admin/update-balance', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({phone: myPhone, amount: win}) });
            document.getElementById('b1').style.display = 'block'; document.getElementById('o1').style.display = 'none'; loadUser();
        }

        if(myPhone) { document.getElementById('auth-screen').style.display = 'none'; loadUser(); }
    </script>
</body>
</html>
