<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        .header { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #333; font-size: 0.9rem; }
        
        /* Sehemu ya Mchezo */
        #stage { height: 200px; position: relative; background: #000; overflow: hidden; border-bottom: 1px solid #222; }
        #multiplier { position: absolute; top: 20%; width: 100%; text-align: center; font-size: 3.5rem; font-weight: 900; z-index: 10; }
        #rocket-wrap { position: absolute; bottom: 15%; left: 10%; font-size: 40px; }
        
        .history-bar { display: flex; gap: 4px; padding: 5px; justify-content: center; background: #080808; overflow-x: auto; }
        .hist-item { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; background: #1a1a1a; border: 1px solid #333; font-weight: bold; }

        /* Mfumo wa Tabs ili kutosheleza kila kitu */
        .tab-buttons { display: flex; background: #111; }
        .tab-btn { flex: 1; padding: 10px; border: none; color: #888; background: none; font-size: 0.8rem; font-weight: bold; }
        .tab-btn.active { color: gold; border-bottom: 2px solid gold; background: #1a1a1a; }

        .tab-content { flex: 1; display: none; padding: 8px; overflow-y: auto; }
        .tab-content.active { display: block; }

        /* Bet Cards */
        .bet-card { background: #151515; padding: 10px; border-radius: 8px; border: 1px solid #222; margin-bottom: 8px; }
        .input-row { display: flex; gap: 5px; margin-bottom: 5px; }
        input { flex: 1; padding: 8px; background: #000; color: gold; border: 1px solid #333; border-radius: 4px; font-size: 0.8rem; }
        
        .btn { width: 100%; padding: 10px; border: none; border-radius: 4px; font-weight: bold; text-transform: uppercase; cursor: pointer; }
        .btn-bet { background: #28a745; color: white; }
        .btn-out { background: #ffc107; color: black; display: none; }

        /* Chat Layout */
        #chat-msgs { height: 120px; overflow-y: auto; font-size: 0.75rem; color: #ccc; margin-bottom: 5px; border-bottom: 1px solid #222; }
        .chat-input { display: flex; gap: 5px; }

        .footer { display: flex; gap: 5px; padding: 8px; background: #000; }
    </style>
</head>
<body>
    <div class="header">
        <span style="color:gold;">VATWHITE</span>
        <span style="color:#28a745;"><span id="bal">0.00</span> KES</span>
    </div>

    <div id="stage">
        <div id="multiplier">1.00x</div>
        <div id="rocket-wrap">ðŸš€</div>
        <svg style="position:absolute; width:100%; height:100%;"><path id="gold-path" d="" fill="none" stroke="gold" stroke-width="3"/></svg>
    </div>

    <div class="history-bar" id="history-list"></div>

    <div class="tab-buttons">
        <button class="tab-btn active" onclick="openTab('tab-bet', this)">BETTING</button>
        <button class="tab-btn" onclick="openTab('tab-chat', this)">LIVE CHAT</button>
        <button class="tab-btn" onclick="openTab('tab-menu', this)">MENU</button>
    </div>

    <div id="tab-bet" class="tab-content active">
        <div class="bet-card">
            <div class="input-row">
                <input type="number" id="amt1" value="5" min="5">
                <input type="number" id="auto1" placeholder="Auto Cash (e.g 1.50)">
            </div>
            <button id="btn1" class="btn btn-bet" onclick="bet(1)">BET</button>
            <button id="out1" class="btn btn-out" onclick="cash(1)">CASH OUT</button>
            <label style="font-size: 0.7rem; color: #888;"><input type="checkbox" id="abt1"> Auto Bet</label>
        </div>
        <div class="bet-card">
            <div class="input-row">
                <input type="number" id="amt2" value="5" min="5">
                <input type="number" id="auto2" placeholder="Auto Cash">
            </div>
            <button id="btn2" class="btn btn-bet" onclick="bet(2)">BET</button>
            <button id="out2" class="btn btn-out" onclick="cash(2)">CASH OUT</button>
            <label style="font-size: 0.7rem; color: #888;"><input type="checkbox" id="abt2"> Auto Bet</label>
        </div>
    </div>

    <div id="tab-chat" class="tab-content">
        <div id="chat-msgs"></div>
        <div class="chat-input">
            <input type="text" id="m_text" placeholder="Andika ujumbe...">
            <button class="btn btn-bet" style="width: auto; padding: 5px 15px;" onclick="send()">TUMA</button>
        </div>
    </div>

    <div id="tab-menu" class="tab-content">
        <button class="btn" style="background:#ffc107; margin-bottom:10px;" onclick="alert('Lipa 0702170114')">DEPOSIT PESA</button>
        <button class="btn" style="background:#333; margin-bottom:10px;">WITHDRAW</button>
        <button class="btn" style="background:#ff0000;" onclick="localStorage.clear();location.reload();">LOGOUT</button>
    </div>

    <script>
        const socket = io();
        let x = 0, y = 0, currentM = 1.0;
        let activeBets = { 1: false, 2: false };

        function openTab(name, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(name).classList.add('active');
            el.classList.add('active');
        }

        socket.on('tick', (m) => {
            currentM = parseFloat(m);
            document.getElementById('multiplier').innerText = m + "x";
            x += 2.0; y += 1.3;
            document.getElementById('rocket-wrap').style.transform = `translate(${x}px, -${y}px)`;
            document.getElementById('gold-path').setAttribute('d', `M 0 200 Q ${x/2} 200, ${x+20} ${200-y}`);

            [1, 2].forEach(id => {
                let autoVal = parseFloat(document.getElementById('auto' + id).value);
                if(activeBets[id] && autoVal > 0 && currentM >= autoVal) cash(id);
            });
        });

        function bet(id) {
            activeBets[id] = true;
            document.getElementById('btn' + id).style.display = 'none';
            document.getElementById('out' + id).style.display = 'block';
            socket.emit('place_bet', { id, amt: document.getElementById('amt'+id).value });
        }

        function cash(id) {
            if(!activeBets[id]) return;
            activeBets[id] = false;
            let win = (document.getElementById('amt' + id).value * currentM).toFixed(2);
            alert("Hongera! Umeshinda KES " + win);
            document.getElementById('btn' + id).style.display = 'block';
            document.getElementById('out' + id).style.display = 'none';
            socket.emit('player_cashout', { id, win, m: currentM });
        }

        socket.on('crash', () => {
            document.getElementById('multiplier').style.color = 'red';
            document.getElementById('rocket-wrap').innerHTML = 'ðŸ’¥';
            [1, 2].forEach(id => { 
                activeBets[id] = false;
                document.getElementById('btn' + id).style.display = 'block';
                document.getElementById('out' + id).style.display = 'none';
            });
        });

        socket.on('new_game', () => {
            x = 0; y = 0;
            document.getElementById('multiplier').style.color = 'white';
            document.getElementById('rocket-wrap').innerHTML = 'ðŸš€';
            document.getElementById('rocket-wrap').style.transform = `translate(0,0)`;
            document.getElementById('gold-path').setAttribute('d', '');
            [1, 2].forEach(id => { if(document.getElementById('abt' + id).checked) bet(id); });
        });

        socket.on('history', (data) => {
            document.getElementById('history-list').innerHTML = data.map(v => 
                `<div class="hist-item" style="color:${v >= 2 ? '#2ecc71' : '#ff4d4d'}">${v}x</div>`
            ).join('');
        });

        // Chat Logic
        function send() {
            const txt = document.getElementById('m_text').value;
            if(txt) { socket.emit('send_msg', { text: txt }); document.getElementById('m_text').value = ''; }
        }
        socket.on('new_msg', (data) => {
            const div = document.getElementById('chat-msgs');
            div.innerHTML += `<div><b>Mtumiaji:</b> ${data.text}</div>`;
            div.scrollTop = div.scrollHeight;
        });
    </script>
</body>
</html>
