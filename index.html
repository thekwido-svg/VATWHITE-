<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VATWHITE</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; text-align: center; }
        .btn { padding: 15px; margin: 5px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; }
        .btn-red { background: #d40000; color: white; width: 80%; }
        input { width: 80%; padding: 12px; margin: 8px; background: #111; color: white; border: 1px solid #333; }
        #game-screen { display: none; }
        #multiplier { font-size: 50px; margin: 40px 0; color: #00ff00; }
    </style>
</head>
<body>
    <div id="auth-screen">
        <h1 style="color:red">VATWHITE</h1>
        <input type="text" id="fn" placeholder="Jina la Kwanza">
        <input type="text" id="ln" placeholder="Jina la Pili">
        <input type="text" id="ph" placeholder="Namba ya Simu">
        <input type="password" id="pw" placeholder="Password">
        <button class="btn btn-red" onclick="anza()">JISAJILI & ANZA</button>
    </div>

    <div id="game-screen">
        <div style="background:#111; padding:10px; display:flex; justify-content:space-between;">
            <span id="u-name">...</span>
            <span style="color:yellow">KES <b id="u-bal">0.00</b></span>
        </div>
        <div style="margin: 10px;">
            <button onclick="deposit()" style="background:green; color:white; padding:10px;">DEPOSIT</button>
            <button onclick="withdraw()" style="background:#333; color:white; padding:10px;">WITHDRAW</button>
        </div>
        <div id="multiplier">1.00x</div>
        <img src="https://i.ibb.co/V99n9vM/rocket.png" id="ndege" style="width:50px; position:absolute; left:10%; bottom:20%;">
    </div>

<script>
    let me = null;
    async function anza() {
        const d = { firstName:document.getElementById('fn').value, lastName:document.getElementById('ln').value, phone:document.getElementById('ph').value, password:document.getElementById('pw').value };
        const res = await fetch('/api/register', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(d) });
        const r = await res.json();
        if(r.success) {
            me = r.user;
            document.getElementById('auth-screen').style.display='none';
            document.getElementById('game-screen').style.display='block';
            document.getElementById('u-name').innerText = me.name;
            document.getElementById('u-bal').innerText = parseFloat(me.balance).toFixed(2);
            startSync();
        }
    }

    function startSync() {
        setInterval(async () => {
            const res = await fetch('/api/game-state');
            const data = await res.json();
            document.getElementById('multiplier').innerText = data.multiplier.toFixed(2) + "x";
            const p = document.getElementById('ndege');
            p.style.left = (10 + (data.multiplier * 2)) + "%";
            p.style.bottom = (20 + (data.multiplier * 3)) + "%";
            if(data.multiplier === 1.00) { p.style.left="10%"; p.style.bottom="20%"; }
        }, 100);
    }

    function deposit() { alert("LIPA KWA: 0702170114\nJina: VATWHITE\nKisha subiri admin aweke salio."); }
    async function withdraw() {
        const amt = prompt("Kiasi unachotoa:");
        if(amt) {
            const res = await fetch('/api/withdraw', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({phone:me.phone, amount:amt}) });
            const data = await res.json();
            alert(data.message);
            location.reload();
        }
    }
</script>
</body>
</html>
