<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VATWHITE - REAL GAME</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; text-align: center; }
        .top-bar { display: flex; justify-content: space-between; padding: 15px; background: #111; border-bottom: 2px solid #facc15; }
        .multiplier { font-size: 80px; color: #facc15; margin: 20px 0; font-weight: bold; }
        .stage { height: 250px; position: relative; background: radial-gradient(circle, #1a1a1a, #000); overflow: hidden; }
        .rocket { position: absolute; bottom: 10%; left: 10%; font-size: 50px; transition: 0.1s linear; }
        .bet-box { background: #151515; padding: 20px; position: fixed; bottom: 0; width: 100%; box-sizing: border-box; }
        #auth-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: #000; z-index: 1000; padding-top: 50px; }
        input { background: #222; border: 1px solid #444; color: #fff; padding: 12px; margin: 5px; width: 80%; border-radius: 8px; }
        .btn { padding: 15px; border: none; border-radius: 10px; font-weight: bold; width: 80%; cursor: pointer; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <h2 style="color:#facc15">VATWHITE REGISTRATION</h2>
        <input type="text" id="regName" placeholder="Jina Kamili">
        <input type="text" id="regPhone" placeholder="Namba ya MPESA (07...)">
        <button class="btn" style="background:#22c55e" onclick="register()">ANZA KUCHEZA</button>
    </div>

    <div class="top-bar">
        <div><span id="uName">VATWHITE</span> <button onclick="alert('Lipa hapa: 0702170114')" style="background:#22c55e; border:none; color:#fff; padding:5px; border-radius:5px;">DEPOSIT</button></div>
        <span>KES <b id="bal">0.00</b></span>
    </div>

    <div class="multiplier" id="m-display">1.00x</div>
    <div class="stage"><div class="rocket" id="rocket">ðŸš€</div></div>

    <div style="font-size: 11px; color: #666; padding: 10px;">Safari moja kwa wote: Juma, Otieno, Sarah, Kamau...</div>

    <div class="bet-box">
        <button class="btn" style="background:#22c55e" onclick="alert('Dau limewekwa!')">BET</button>
        <button class="btn" style="background:#facc15; color:#000; margin-top:10px;" onclick="doWithdraw()">WITHDRAW</button>
    </div>

    <audio id="s-engine" src="https://www.soundjay.com/transportation/sounds/jet-pass-by-01.mp3" loop></audio>

    <script>
        let userName = ""; let userPhone = "";
        
        async function register() {
            userName = document.getElementById('regName').value;
            userPhone = document.getElementById('regPhone').value;
            if(userName && userPhone) {
                // Tuma usajili kwa server yako ya kweli
                await fetch('/register', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ name: userName, phone: userPhone })
                });
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('uName').innerText = userName;
                startSync();
            }
        }

        async function doWithdraw() {
            let kiasi = prompt("Weka kiasi unachotaka kutoa:");
            if(kiasi > 0) {
                await fetch('/withdraw-request', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ name: userName, phone: userPhone, amount: kiasi })
                });
                alert("Ombi la kutoa KES " + kiasi + " limetumwa kwa Admin.");
            }
        }

        function startSync() {
            setInterval(async () => {
                const res = await fetch('/game-state');
                const data = await res.json();
                const mDisplay = document.getElementById('m-display');
                const rocket = document.getElementById('rocket');
                const engine = document.getElementById('s-engine');

                if (data.isCrashed) {
                    mDisplay.innerText = "FLEW AWAY!"; mDisplay.style.color = "red";
                    engine.pause();
                    rocket.style.left = "10%"; rocket.style.bottom = "10%";
                } else {
                    mDisplay.innerText = data.multiplier + "x"; mDisplay.style.color = "#facc15";
                    if(engine.paused) engine.play().catch(()=>{});
                    let val = parseFloat(data.multiplier);
                    rocket.style.left = (10 + (val * 3)) + "%";
                    rocket.style.bottom = (10 + (val * 5)) + "%";
                }
            }, 100);
        }
    </script>
</body>
</html>
