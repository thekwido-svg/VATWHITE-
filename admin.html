<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; padding: 10px; }
        .card { background: #111; padding: 20px; border-radius: 12px; border: 1px solid #333; margin-bottom: 15px; }
        input { width: 100%; padding: 15px; margin: 10px 0; background: #000; color: gold; border: 1px solid #444; font-size: 1rem; box-sizing: border-box; }
        button { width: 100%; padding: 18px; border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-top: 5px; }
        .btn-green { background: #28a745; color: #fff; }
        .btn-yellow { background: gold; color: #000; }
        .btn-red { background: #dc3545; color: #fff; }
    </style>
</head>
<body>
    <h2 style="color:gold; text-align:center;">VATWHITE ADMIN CONTROL</h2>

    <div class="card">
        <h3 style="color:gold;">DHIBITI ROCKET (CRASH)</h3>
        <input type="number" id="next-point" value="1.00" step="0.01">
        <button class="btn-yellow" onclick="setCrash()">SET NEXT CRASH</button>
    </div>

    <div class="card">
        <h3 style="color:gold;">TAFUTA & BADILISHA PESA</h3>
        <input type="number" id="s-phone" placeholder="Namba ya Mchezaji">
        <button style="background:#444; color:#fff;" onclick="getUser()">TAFUTA MCHEZAJI</button>
        <div id="u-data" style="margin-top:15px; display:none; border-top:1px solid #333; pt-10px;">
            <p>Salio: <span id="u-bal" style="color:lime">0.00</span> KES</p>
            <input type="number" id="mod-amt" placeholder="Kiasi (Mfano: 500)">
            <button class="btn-green" onclick="update(1)">ONGEZA PESA</button>
            <button class="btn-red" onclick="update(-1)">PUNGUZA PESA</button>
        </div>
    </div>

    <div class="card">
        <h3 style="color:gold;">NAMBA ZA DEPOSIT</h3>
        <input type="text" id="p-meth" placeholder="Method (e.g. TILL)">
        <input type="text" id="p-num" placeholder="Namba ya Malipo">
        <input type="text" id="p-name" placeholder="Jina la Account">
        <button class="btn-green" onclick="updatePay()">BADILISHA MALIPO</button>
    </div>

    <script>
        async function setCrash() {
            const point = document.getElementById('next-point').value;
            await fetch('/admin/set-crash', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({point}) });
            alert("Mchezo ujao utaanguka kwa " + point + "x");
        }
        async function getUser() {
            const phone = document.getElementById('s-phone').value;
            const res = await fetch('/admin/user-details/' + phone);
            const data = await res.json();
            if(data) { document.getElementById('u-data').style.display='block'; document.getElementById('u-bal').innerText = data.bal; }
            else alert("Hajapatikana!");
        }
        async function update(t) {
            const phone = document.getElementById('s-phone').value;
            let amt = parseFloat(document.getElementById('mod-amt').value);
            if(t === -1) amt = -Math.abs(amt);
            await fetch('/admin/update-balance', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({phone, amount: amt}) });
            alert("Salio limebadilishwa!"); getUser();
        }
        async function updatePay() {
            const body = { method: document.getElementById('p-meth').value, number: document.getElementById('p-num').value, name: document.getElementById('p-name').value };
            await fetch('/admin/update-payment', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
            alert("Namba za malipo zimebadilishwa!");
        }
    </script>
</body>
</html>
